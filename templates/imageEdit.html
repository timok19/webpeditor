{% extends '_base.html' %} {% load static %} {% block content %}
  <style>
    /* Custom styles */

    .info {
      background-color: #eee;
      padding: 20px;
    }

    .info p {
      margin-bottom: 5px;
    }

    .info hr {
      margin: 10px 0;
    }

    .info h2 {
      margin: 0;
      font-size: 18px;
      font-weight: bold;
    }
  </style>

  <div class="flex justify-center items-center h-[calc(80vh)]">
    <main class="mx-auto">
      <div class="px-4 py-8 sm:px-0">
        {% if edited_image_form.is_multipart %}
          <form method="post" enctype="multipart/form-data">
        {% else %}
          <form method="post">
        {% endif %}

        {% csrf_token %}
        {{ edited_image_form.as_div }}

        <div class="grid grid-cols-8 gap-4">
          <div class="col-span-1 flex flex-col justify-center items-center">
            <div class="flex flex-col items-end justify-center md:flex-col">
              <div
                class="flex flex-wrap justify-center gap-2 md:w-1/3"
              >
                <button
                  type="button"
                  id="crop-image"
                  class="mr-2 inline-flex items-center rounded-lg bg-orange-500 p-2.5 text-center text-sm font-medium text-white hover:bg-orange-800 focus:outline-none focus:ring-4 focus:ring-orange-300 dark:bg-orange-500 dark:hover:bg-orange-600 dark:focus:ring-orange-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>

                <button
                  type="submit"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>

                <button
                  type="button"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>
                <button
                  type="button"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>
                <button
                  type="button"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>
                <button
                  type="button"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>
                <button
                  type="button"
                  id="apply-crop"
                  class="mr-2 inline-flex items-center rounded-lg bg-blue-700 p-2.5 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    class="h-5 w-5"
                    stroke-width="1.5"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M7.848 8.25l1.536.887M7.848 8.25a3 3 0 11-5.196-3 3 3 0 015.196 3zm1.536.887a2.165 2.165 0 011.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 11-5.196 3 3 3 0 015.196-3zm1.536-.887a2.165 2.165 0 001.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863l2.077-1.199m0-3.328a4.323 4.323 0 012.068-1.379l5.325-1.628a4.5 4.5 0 012.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.331 4.331 0 0010.607 12m3.736 0l7.794 4.5-.802.215a4.5 4.5 0 01-2.48-.043l-5.326-1.629a4.324 4.324 0 01-2.068-1.379M14.343 12l-2.882 1.664"
                    ></path>
                  </svg>
                  <span class="sr-only">Icon description</span>
                </button>
              </div>
            </div>
          </div>
          <!-- /End replace -->

          <div class="col-span-5 flex items-center justify-center">
            <img
              src="{{ edited_image_url_to_fe }}"
              class="max-w-full object-cover"
              alt="Image To Edit"
              style="max-height: 75vh"
              id="image-edit"
            />
          </div>

          <div class="col-span-2 flex flex-col justify-center">
            <div class="flex flex-col justify-center pr-[3rem]">
              <div
                class="p-5 bg-white max-w-screen-md border max-w-6xl border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                <div class="contents">
                  <div
                    class="text-left flex flex-col justify-center pt-5 pb-5 pl-5 overscroll-contain md:h-[calc(50vh)]">

                    <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Image
                      properties:</h5>
                    <p class="font-bold text-gray-700 dark:text-gray-200">Name: &nbsp;<span
                      class="font-normal dark:text-gray-400"
                      style="font-family: Consolas, monospace">{{ edited_image_name }}</span>
                    </p>
                    <p class="font-bold text-gray-700 dark:text-gray-200">Format: &nbsp;<span
                      class="font-normal dark:text-gray-400"
                      style="font-family: Consolas, monospace">{{ edited_image_format }}</span>
                    </p>
                    <p class="font-bold text-gray-700 dark:text-gray-200">Resolution: &nbsp;<span
                      class="font-normal dark:text-gray-400"
                      style="font-family: Consolas, monospace">{{ edited_image_resolution }}</span>
                    </p>
                    <p class="font-bold text-gray-700 dark:text-gray-200">Size: &nbsp;<span
                      class="font-normal dark:text-gray-400"
                      style="font-family: Consolas, monospace">{{ edited_image_size }}</span>
                    </p>
                    <p class="mb-4 font-bold text-gray-700 dark:text-gray-200">Aspect ratio: &nbsp;<span
                      class="font-normal dark:text-gray-400"
                      style="font-family: Consolas, monospace">{{ edited_image_aspect_ratio }}</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </form>

      </div>
      <!-- /End replace -->
    </main>
  </div>

  {% block cropperjs %}
    <script type="text/javascript">
      let cropper = null;
      const image = document.getElementById("image-edit");

      document.getElementById("crop-image").addEventListener("click", () => {
        cropper = new Cropper(image, {
          aspectRatio: 1,
          viewMode: 1
        });
      });

      document.getElementById("apply-crop").addEventListener("click", () => {
        const croppedCanvas = cropper.getCroppedCanvas();
        const croppedImage = new Image();
        croppedImage.src = croppedCanvas.toDataURL();

        image.parentNode.replaceChild(croppedImage, image);
        // TODO: change logic
        cropper.destroy();
        cropper = null;
      });

      document.getElementById("apply-crop").onclick = () => {
        const request = new XMLHttpRequest();
        request.onreadystatechange = function () {
          if (this.status === 200 && this.readyState === 4) {
            console.log(this.responseText);
          }
        }

        request.open("POST", "/edit_image")
        request.setRequestHeader("X-CSRFToken", "{{ csrf_token }}")
        request.send()
      }
    </script>
  {% endblock cropperjs %}

{% endblock content %}
